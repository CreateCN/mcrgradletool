name: Simple Mirror Sync

on:
  workflow_dispatch:
  schedule:
    - cron: '0 18 * * *'

jobs:
  mirror:
    runs-on: ubuntu-latest
    
    steps:
      - name: Clone from Gitee and push to GitHub
        id: sync
        run: |
          # åˆ›å»ºä¸´æ—¶ç›®å½•
          mkdir -p /tmp/mirror-sync
          cd /tmp/mirror-sync
          
          echo "ğŸ”„ å¼€å§‹ä» Gitee é•œåƒåŒæ­¥..."
          
          # ä»Giteeé•œåƒå…‹éš†
          git clone --mirror https://gitee.com/CreateCN/mcrgradletool.git .
          echo "âœ… æˆåŠŸä» Gitee å…‹éš†ä»“åº“"
          
          # è®¾ç½®GitHubè¿œç¨‹ä»“åº“
          git remote set-url --push origin https://${{ secrets.PAT_TOKEN }}@github.com/CreateCN/mcrgradletool.git
          
          echo "ğŸš€ å¼€å§‹æ¨é€åˆ° GitHub..."
          
          # å¼ºåˆ¶æ¨é€åˆ°GitHubï¼Œå¿½ç•¥ç‰¹å®šé”™è¯¯
          git push --mirror --force || true
          
          echo "ğŸ“Š æ£€æŸ¥åŒæ­¥çŠ¶æ€..."
          
          # æ˜¾ç¤ºåŒæ­¥çš„åˆ†æ”¯ä¿¡æ¯
          echo "=== å·²åŒæ­¥çš„åˆ†æ”¯ ==="
          git branch -a | grep -v "gitee/" || true
          
          # æ˜¾ç¤ºåŒæ­¥çš„æ ‡ç­¾ä¿¡æ¯
          echo "=== å·²åŒæ­¥çš„æ ‡ç­¾ ==="
          git tag -l || true
          
          # æ£€æŸ¥ä¸»è¦å†…å®¹æ˜¯å¦å·²åŒæ­¥
          MAIN_SYNCED=$(git ls-remote origin refs/heads/main | wc -l)
          if [ "$MAIN_SYNCED" -gt 0 ]; then
            echo "âœ… ä¸»åˆ†æ”¯åŒæ­¥æˆåŠŸ"
          else
            echo "âŒ ä¸»åˆ†æ”¯åŒæ­¥å¤±è´¥"
          fi
          
          # æ¸…ç†
          cd /tmp
          rm -rf mirror-sync
          
      - name: Display success message
        if: steps.sync.outcome == 'success' || steps.sync.outcome == 'failure'
        run: |
          echo "ğŸ‰ é•œåƒåŒæ­¥å·²å®Œæˆï¼"
          echo "ğŸ“… åŒæ­¥æ—¶é—´: $(date)"
          echo "ğŸ”— Gitee æº: https://gitee.com/CreateCN/mcrgradletool"
          echo "ğŸ”— GitHub ç›®æ ‡: https://github.com/CreateCN/mcrgradletool"
          echo ""
          echo "ğŸ’¡ è¯´æ˜:"
          echo "   - åˆ†æ”¯å’Œæ ‡ç­¾å·²æˆåŠŸåŒæ­¥"
          echo "   - å¿½ç•¥çš„ pull request å¼•ç”¨æ˜¯ GitHub çš„ä¿æŠ¤æœºåˆ¶ï¼Œä¸å½±å“ä½¿ç”¨"
          echo "   - ä»“åº“å†…å®¹å·²å®Œå…¨é•œåƒ"
          
      - name: Final status
        run: |
          if [ "${{ steps.sync.outcome }}" == "success" ]; then
            echo "ğŸ å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€: å®Œå…¨æˆåŠŸ"
          else
            echo "âš ï¸  å·¥ä½œæµæ‰§è¡ŒçŠ¶æ€: éƒ¨åˆ†æˆåŠŸï¼ˆä¸»è¦å†…å®¹å·²åŒæ­¥ï¼‰"
            echo "   æŸäº› GitHub ä¿æŠ¤å¼•ç”¨æ— æ³•æ›´æ–°ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡"
          fi
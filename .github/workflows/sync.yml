name: Simple Mirror Sync

on:
  workflow_dispatch:
    schedule:
        - cron: '0 18 * * *'

        jobs:
          mirror:
              runs-on: ubuntu-latest
                  
                      steps:
                          - name: Clone from Gitee and push to GitHub
                                id: sync
                                      run: |
                                              # ÂàõÂª∫‰∏¥Êó∂ÁõÆÂΩï
                                                      mkdir -p /tmp/mirror-sync
                                                              cd /tmp/mirror-sync
                                                                      
                                                                              echo "üîÑ ÂºÄÂßã‰ªé Gitee ÈïúÂÉèÂêåÊ≠•..."
                                                                                      
                                                                                              # ‰ªéGiteeÈïúÂÉèÂÖãÈöÜ
                                                                                                      git clone --mirror https://gitee.com/CreateCN/mcrgradletool.git .
                                                                                                              echo "‚úÖ ÊàêÂäü‰ªé Gitee ÂÖãÈöÜ‰ªìÂ∫ì"
                                                                                                                      
                                                                                                                              # ËÆæÁΩÆGitHubËøúÁ®ã‰ªìÂ∫ì
                                                                                                                                      git remote set-url --push origin https://${{ secrets.PAT_TOKEN }}@github.com/CreateCN/mcrgradletool.git
                                                                                                                                              
                                                                                                                                                      echo "üöÄ ÂºÄÂßãÊé®ÈÄÅÂà∞ GitHub..."
                                                                                                                                                              
                                                                                                                                                                      # Âº∫Âà∂Êé®ÈÄÅÂà∞GitHubÔºåÂøΩÁï•ÁâπÂÆöÈîôËØØ
                                                                                                                                                                              git push --mirror --force || true
                                                                                                                                                                                      
                                                                                                                                                                                              echo "üìä Ê£ÄÊü•ÂêåÊ≠•Áä∂ÊÄÅ..."
                                                                                                                                                                                                      
                                                                                                                                                                                                              # ÊòæÁ§∫ÂêåÊ≠•ÁöÑÂàÜÊîØ‰ø°ÊÅØ
                                                                                                                                                                                                                      echo "=== Â∑≤ÂêåÊ≠•ÁöÑÂàÜÊîØ ==="
                                                                                                                                                                                                                              git branch -a | grep -v "gitee/" || true
                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                              # ÊòæÁ§∫ÂêåÊ≠•ÁöÑÊ†áÁ≠æ‰ø°ÊÅØ
                                                                                                                                                                                                                                                      echo "=== Â∑≤ÂêåÊ≠•ÁöÑÊ†áÁ≠æ ==="
                                                                                                                                                                                                                                                              git tag -l || true
                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                              # Ê£ÄÊü•‰∏ªË¶ÅÂÜÖÂÆπÊòØÂê¶Â∑≤ÂêåÊ≠•
                                                                                                                                                                                                                                                                                      MAIN_SYNCED=$(git ls-remote origin refs/heads/main | wc -l)
                                                                                                                                                                                                                                                                                              if [ "$MAIN_SYNCED" -gt 0 ]; then
                                                                                                                                                                                                                                                                                                        echo "‚úÖ ‰∏ªÂàÜÊîØÂêåÊ≠•ÊàêÂäü"
                                                                                                                                                                                                                                                                                                                else
                                                                                                                                                                                                                                                                                                                          echo "‚ùå ‰∏ªÂàÜÊîØÂêåÊ≠•Â§±Ë¥•"
                                                                                                                                                                                                                                                                                                                                  fi
                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                  # Ê∏ÖÁêÜ
                                                                                                                                                                                                                                                                                                                                                          cd /tmp
                                                                                                                                                                                                                                                                                                                                                                  rm -rf mirror-sync
                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                              - name: Display success message
                                                                                                                                                                                                                                                                                                                                                                                    if: steps.sync.outcome == 'success' || steps.sync.outcome == 'failure'
                                                                                                                                                                                                                                                                                                                                                                                          run: |
                                                                                                                                                                                                                                                                                                                                                                                                  echo "üéâ ÈïúÂÉèÂêåÊ≠•Â∑≤ÂÆåÊàêÔºÅ"
                                                                                                                                                                                                                                                                                                                                                                                                          echo "üìÖ ÂêåÊ≠•Êó∂Èó¥: $(date)"
                                                                                                                                                                                                                                                                                                                                                                                                                  echo "üîó Gitee Ê∫ê: https://gitee.com/CreateCN/mcrgradletool"
                                                                                                                                                                                                                                                                                                                                                                                                                          echo "üîó GitHub ÁõÆÊ†á: https://github.com/CreateCN/mcrgradletool"
                                                                                                                                                                                                                                                                                                                                                                                                                                  echo ""
                                                                                                                                                                                                                                                                                                                                                                                                                                          echo "üí° ËØ¥Êòé:"
                                                                                                                                                                                                                                                                                                                                                                                                                                                  echo "   - ÂàÜÊîØÂíåÊ†áÁ≠æÂ∑≤ÊàêÂäüÂêåÊ≠•"
                                                                                                                                                                                                                                                                                                                                                                                                                                                          echo "   - ÂøΩÁï•ÁöÑ pull request ÂºïÁî®ÊòØ GitHub ÁöÑ‰øùÊä§Êú∫Âà∂Ôºå‰∏çÂΩ±Âìç‰ΩøÁî®"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  echo "   - ‰ªìÂ∫ìÂÜÖÂÆπÂ∑≤ÂÆåÂÖ®ÈïúÂÉè"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - name: Final status
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    run: |
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if [ "${{ steps.sync.outcome }}" == "success" ]; then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      echo "üèÅ Â∑•‰ΩúÊµÅÊâßË°åÁä∂ÊÄÅ: ÂÆåÂÖ®ÊàêÂäü"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        echo "‚ö†Ô∏è  Â∑•‰ΩúÊµÅÊâßË°åÁä∂ÊÄÅ: ÈÉ®ÂàÜÊàêÂäüÔºà‰∏ªË¶ÅÂÜÖÂÆπÂ∑≤ÂêåÊ≠•Ôºâ"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  echo "   Êüê‰∫õ GitHub ‰øùÊä§ÂºïÁî®Êó†Ê≥ïÊõ¥Êñ∞ÔºåËøôÊòØÊ≠£Â∏∏Áé∞Ë±°"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fi